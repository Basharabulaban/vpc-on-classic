---

copyright:
  years: 2019
lastupdated: "2019-05-29"


keywords: vpc, delete, resources

subcollection: vpc-on-classic
---

{:shortdesc: .shortdesc}
{:new_window: target="_blank"}
{:codeblock: .codeblock}
{:pre: .pre}
{:pre: .pre}
{:screen: .screen}
{:tip: .tip}
{:important: .important}
{:note: .note}
{:download: .download}
{:DomainName: data-hd-keyref="DomainName"}

# 刪除 VPC
{: #deleting}

如果 {{site.data.keyword.cloud}} Virtual Private Cloud 資源包含其他資源，或者連接到其他資源，則無法予以刪除。本文件說明了 VPC 資源之間的關係，並提供了有關刪除 VPC 的最佳作法的資訊。

下表概述了 VPC 資源的類型以及刪除這些資源時要考慮的關係。

| 資源     |刪除之前...|刪除之後...|
| ---------------- | ----------------------------------------- | --------------------------- |
| VPC |必須刪除該 VPC 中的所有子網路和公用閘道|將自動刪除所有安全群組和位址字首|
| 子網路 |必須刪除該子網路中的所有實例和任何網路介面；必須刪除該子網路中的所有 VPN 閘道和負載平衡器|將分離為子網路服務的任何公用閘道；將分離與該子網路關聯的任何網路 ACL|
| 實例 | ---- |將自動刪除所有網路介面；開機磁區會隨實例一起刪除；是否刪除次要磁區取決於 `delete_volume_on_instance_delete` 參數；將自動分離連接到其中某個網路介面的任何浮動 IP|
|網路介面| ---- |將釋放連接到該網路介面的任何浮動 IP|
| 金鑰 | ---- |刪除金鑰後，此金鑰即無法再用於佈建新實例，也無法對現有實例執行作業系統重新載入。但是，該金鑰仍在使用它佈建的任何實例上可用，並且您可以繼續使用此金鑰進行登入。|
| 映像檔 | ---- |該映像檔無法用於佈建新實例，但該映像檔的現有實例不受影響。|
| 磁區 |必須從所有實例分離該磁區| ---- |
|網路 ACL |必須從所有子網路分離該網路 ACL；無法刪除 VPC 的預設網路 ACL| ---- |
| 安全群組 |必須從所有網路介面分離該安全群組；無法刪除 VPC 的預設安全群組。| ---- |
| 浮動 IP |必須從任何網路介面分離該浮動 IP| ---- |
| 公用閘道 |必須從所有子網路分離該公用閘道|  ---- |
|負載平衡器| ---- | ---- |
| VPN 閘道 | ---- |由於能夠在閘道之間共用 IKE 和 IPsec 原則，刪除 VPN 閘道時不會刪除這些原則。必須手動移除 IKE 和 IPsec 原則。|


## 無法刪除處於暫時性狀態的 VPC 資源
{: #deleting-status}

VPC 資源處於暫時性狀態（例如，`pending`）時，無法刪除這些資源。所有資源都必須處於「最終」狀態（例如，`available` 或 `failed`）後，才能將其刪除。必須等待資源達到 `available` 或 `failed` 狀態之後，才能試圖刪除該資源。如果資源在 30 分鐘內未顯示 `available` 或 `failed` 狀態，請[與支援中心聯絡](/docs/vpc-on-classic?topic=vpc-on-classic-getting-help-and-support)。

發出刪除資源的要求後，該資源即會進入暫時性狀態 `deleting`。等待資源從清單中消失，然後再試圖刪除母項資源或連接的資源。在某些狀況下，刪除作業可能會失敗，並且資源在幾分鐘內會進入 `failed` 狀態。如果在發出刪除要求後，資源在 30 分鐘內未消失，或顯示 `failed` 狀態，請與支援中心聯絡。資源處於 `failed` 狀態後，可以再次試圖將其刪除。如果無法刪除處於 `failed` 狀態的資源，請[與支援中心聯絡](/docs/vpc-on-classic?topic=vpc-on-classic-getting-help-and-support)。

## 刪除 VPC 時遵循此次序
{: #deleting-order}

VPC 包含子網路和公用閘道。公用閘道可以連接到 VPC 中的一個以上子網路。負載平衡器和 VPN 閘道存在於 VPC 的子網路中。子網路還可以包含虛擬伺服器實例 (VSI)，並且一個 VSI 可以在 VPC 的不同子網路中具有多個網路介面。刪除子網路之前，必須先刪除該子網路中的任何 VPN 閘道、負載平衡器和網路介面。VPC 還包含安全群組，但刪除 VPC 時會自動刪除這些安全群組。位址字首是 VPC 的屬性，在刪除 VPC 時會自動刪除這些屬性。

刪除 VPC 時，請遵循以下次序：

1.  刪除在 VPC 的任何子網路中佈建的所有 VPN 閘道。
2.  分離在 VPC 的任何子網路中佈建的所有負載平衡器。
3.  刪除在 VPC 的任何子網路中具有網路介面的所有實例。刪除實例時，會從網路介面分離與該網路介面關聯的任何浮動 IP。
4.  刪除 VPC 中的所有子網路。刪除子網路時，會從該子網路自動分離連接到該子網路的任何公用閘道。
5.  刪除 VPC 中的所有公用閘道。
6.  一旦 VPC 沒有子網路，也沒有公用閘道，就可以刪除該 VPC。刪除 VPC 時，會自動刪除該 VPC 中的所有位址字首。

## VPC 資源關係
{: #deleting-relationships}

某些 VPC 資源包含在其他 VPC 資源中（作為「子項」），但這些其他 VPC 資源是在帳戶層次包含的，存在於任何特定 VPC 外部。必須先刪除所有子 VPC 資源，然後才能刪除母項資源。對於帳戶層次的 VPC 資源，必須先刪除現有資源的所有鏈結，然後才能刪除帳戶資源。

在某些情況下，刪除 VPC 資源會自動移除現有資源的鏈結。以下各表格說明了預期行為。

### VPC
{: #deleting-details}

VPC 包含子網路和公用閘道。負載平衡器、VPN 閘道和實例在子網路中佈建。必須先刪除 VPC 中的所有子網路和所有公用閘道，然後才能刪除 VPC。換句話說，必須先刪除 VPC 中的所有公用閘道、負載平衡器、VPN 閘道和實例。

VPC 還包含位址字首和安全群組，但刪除 VPC 時會自動刪除這些資源。

VPC 必須具有預設安全群組和預設網路 ACL。如果建立 VPC 時未指定預設安全群組和網路 ACL，系統將為 VPC 自動建立預設安全群組和網路 ACL。無法刪除預設安全群組和預設網路 ACL。刪除 VPC 時，會自動刪除預設網路 ACL。此外，刪除 VPC 時，還將自動刪除該 VPC 中的所有安全群組。

|在 VPC 中|可以包含|可以連接至|有狀態？|刪除 VPC 時自動刪除|刪除時自動分離|
| ---------------- | ----------------------------------------- | --------------------------- | ------ | ---------------------------------------------- | ----------------------------------- |
| 子網路 |實例、負載平衡器和 VPN 閘道|公用閘道和網路 ACL|是|否|是|
| 公用閘道 | --- |子網路和浮動 IP|是|否|對於子網路為否，對於浮動 IP 為是|
| 安全群組 | ---  |實例 (NIC) 和 VPC（預設）|否|是|否|

### 子網路
{: #deleting-subnet}

必須先刪除子網路中的所有資源，然後才能刪除該子網路。子網路包含實例的網路介面、負載平衡器和 VPN 閘道。必須先刪除與子網路關聯的網路介面，然後才能刪除該子網路以及該子網路中佈建的任何負載平衡器或 VPN 閘道。

實例可以有多個網路介面，那些網路介面可以屬於 VPC 的多個子網路。子網路中的任何網路介面都必須先刪除，才能夠刪除子網路。無法刪除實例的主要網路介面，也無法將主要網路介面移至其他子網路，因此必須先刪除子網路中具有主要網路介面的所有實例，然後才能刪除該子網路。


|在子網路中|可以包含|可以連接至|有狀態？|刪除子網路時自動刪除|刪除時自動分離|
| ---------------- | ----------------------------------------- | --------------------------- | ------ | ---------------------------------------------- | ----------------------------------- |
|實例（網路介面）|多個網路介面|磁區連接和安全群組|是|否|是|
| VPN | --- | ---|是|否| --- |
| 負載平衡器 | ---  | --- |是|否| ---  |

### 實例 (Instance)
{: #deleting-instance}

刪除實例不需要先決條件。刪除實例時，會自動刪除其所有網路介面。還將刪除實例的開機磁區及其所有磁區連接。將自動釋放連接到其任何網路介面的任何浮動 IP。如果建立磁區時旗標 `delete_volume_on_instance_delete` 設定為 true，則會自動刪除連接到實例的任何區塊儲存空間磁區；否則，將從磁區分離實例，但磁區會保留。如果任何安全群組連接到實例的任何網路介面，則刪除這些網路介面時，也會自動分離這些安全群組。

|在實例中|可以包含|可以連接至|有狀態？|刪除實例時自動刪除|刪除時自動分離|
| ---------------- | ----------------------------------------- | --------------------------- | ------ | ---------------------------------------------- | ----------------------------------- |
|網路介面| --- |子網路、浮動 IP 和安全群組|否|是|是|

###  負載平衡器 
{: #deleting-lb}

刪除負載平衡器不需要先決條件。刪除負載平衡器時，會自動刪除屬於該負載平衡器的所有接聽器、儲存區和儲存區成員。

刪除負載平衡器最長可能需要 30 分鐘。刪除要求會立即將負載平衡器的佈建狀態變更為 `deleting`。但是，直到負載平衡器從清單查詢中消失時，才實際刪除了該負載平衡器。
{: important}

### VPN
{: #deleting-vpn}

刪除 VPN 閘道不需要先決條件。刪除 VPN 閘道時，還會自動刪除其關聯的連線。刪除 VPN 閘道時，不會刪除 IKE 原則和 IPsec 原則。

刪除 VPN 閘道最長可能需要 30 分鐘。刪除要求會立即將 VPN 閘道的佈建狀態變更為 `deleting`。但是，直到 VPN 閘道從清單查詢中消失時，才實際刪除了該 VPN 閘道。
{: important}

### 浮動 IP (Floating IP)
{: #deleting-floating-ip}

浮動 IP 存在於 VPC 外部且處於帳戶層次。如果浮動 IP 連結至公用閘道或實例，則必須刪除（釋放）該鏈結後，才能刪除浮動 IP。

如果刪除連結了浮動 IP 的資源（例如，如果刪除實例的網路介面的話），會自動釋放該浮動 IP。

###  磁區 
{: #deleting-volume}

VPC 中可以存在兩種類型的磁區：區塊儲存空間開機磁區和區塊儲存空間資料磁區。這兩種磁區的刪除方式不同。

**刪除開機磁區**

開機磁區存在於實例中，並且這些磁區不會被視為是獨立於該實例的實體。建立實例時，還會建立開機磁區並將其連接到該實例。刪除實例時，會自動刪除開機磁區。無法在不刪除實例的情況下，單獨刪除開機磁區。

**刪除資料磁區**

區塊儲存空間資料磁區可以獨立於其關聯的虛擬伺服器實例進行佈建和管理。可以將資料磁區作為次要儲存空間連接到一個虛擬伺服器實例。無法刪除連接到實例的資料磁區（即，如果磁區處於 "active" 狀態）。必須先從實例分離磁區，然後才能刪除該磁區。

資料磁區在 API 中具有名為 `delete_volume_on_instance_delete` 的屬性（或旗標），在 CLI 和使用者介面中具有名為 `Auto Delete` 的屬性（或旗標）。如果此旗標設定為 `true`（在使用者介面中為 `Enabled`），刪除具有連接磁區的實例時，會自動分離並刪除該磁區。如果磁區的此旗標設定為 `false`（在使用者介面中為 `Disabled`），則會從該磁區分離實例，但在刪除連接的實例時，不會刪除該磁區。該磁區可以連接到其他實例。

區塊儲存空間磁區一次只能連接到一個虛擬伺服器。
{: tip}

### 安全群組
{: #deleting-secgroup}

如果網路介面正在使用安全群組，或者如果安全群組是 VPC 的預設安全群組，則無法刪除該安全群組。刪除安全群組之前，請先從該安全群組移除所有網路介面，並確保該安全群組未用來作為 VPC 的預設安全群組。

刪除 VPC 將自動刪除該 VPC 中的所有安全群組。

### 網路 ACL
{: #deleting-netacl}

如果子網路正在使用網路 ACL，或者如果網路 ACL 是 VPC 的預設網路 ACL，則無法刪除該網路 ACL。刪除網路 ACL 之前，請先從所有子網路分離該網路 ACL，並確保該網路 ACL 未用作 VPC 的預設網路 ACL。

建立任何 VPC 時，它都需要預設網路 ACL。如果在建立 VPC 時未將現有網路 ACL 指定為預設值，則會建立新的網路 ACL 並將其設定為預設值。刪除 VPC 時，會自動刪除此預設網路 ACL（如果該 ACL 未在其他任何位置使用）。

與安全群組不同，網路 ACL 可以跨 VPC 指派。因此，刪除 VPC 不會刪除網路 ACL。
{: note}

## 後續步驟
{: #deleting-nextsteps}

下列主題提供了有關如何使用 IBM Cloud 主控台、指令行介面或 API 來刪除 VPC 資源的更多範例。

-   [使用使用者介面刪除 VPC 資源](/docs/vpc-on-classic?topic=vpc-on-classic-deleting-using-console)
-   [使用 CLI 刪除 VPC 資源](/docs/vpc-on-classic?topic=vpc-on-classic-deleting-using-cli)
-   [使用 API 刪除 VPC 資源](/docs/vpc-on-classic?topic=vpc-on-classic-deleting-using-api)
