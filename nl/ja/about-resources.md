---

copyright:
  years: 2017, 2018, 2019

lastupdated: "2019-06-04"

keywords: resource, policies, authorization, resource type, resource groups, roles, load balancer, VPN, operator, editor, viewer, admin

subcollection: vpc-on-classic

---

{:shortdesc: .shortdesc}
{:new_window: target="_blank"}
{:codeblock: .codeblock}
{:pre: .pre}
{:screen: .screen}
{:tip: .tip}
{:note: .note}
{:important: .important}
{:download: .download}
{:DomainName: data-hd-keyref="DomainName"}

# VPC インフラストラクチャーのリソースについて
{: #about-vpc-infrastructure-resources}

ここでいう_リソース_ とは、{{site.data.keyword.cloud}} 仮想プライベート・クラウド・デプロイメントの構成部品を指しています。 各 VPC には、以下のタイプのリソースを含められます。必要に応じてグループに分けることもできます。

* **vpc**
* **インスタンス**
* **キー**
* **イメージ**
* **サブネット**
* **ボリューム**
* **ネットワーク・アクセス制御リスト (acl)**
* **セキュリティー・グループ**
* **浮動 IP**
* **vnic**
* **ゲートウェイ**
* **ロード・バランサー**
* **vpn**

VPC インフラストラクチャーのリソースには、使用法を制御する許可ポリシーが親 VPC から継承されるものもあれば、独立して管理されるものもあります。

現在、`インスタンス`、`キー`、`セキュリティー・グループ`、`ボリューム`、`ロード・バランサー`、`vpn` の各リソース・タイプは、独自の許可ポリシーを持ちます。これらのリソースに対するリソース権限の詳細については、この資料の中で後述します。
{: note}

## リソース・ポリシー
{: #resource-policies}

基本的には、VPC のリソースに対するアクセスは_ポリシー_ によって制御されます。 VPC のリソースに対するアクセスをカスタマイズする場合は、カスタマイズ・ポリシーを作成します。 以下をリソース・ポリシーのターゲットにすることができます。

* すべてのリソース
* 特定のタイプのすべてのリソース
* 特定のグループのすべてのリソース
* 個々のリソース

## リソースとリソース・グループ
{: #resources-and-resource-groups}

_リソース・グループ_ とは、権限や使用法を設定する目的でまとめられたリソースの集まりのことです。例えば、VPC 全体であったり、サブネット 1 つとその ACL であったりします。 リソース・グループは、特定のプロジェクト、部門、またはチーム用のインフラストラクチャーの集合と考えることができます。

search CLI を使用して、リソースに付加されたタグを表示できます。`ibmcloud resource search name:` や `ibmcloud resource search 'service_name:is AND type:vpc'` などの適切なフィルターを使用して、関心のあるインスタンスのみを表示できます。
{: tip}

規模の大きい企業では、1 つの VPC を複数のリソース・グループに分割する必要があるでしょう。 規模の小さい会社でチーム全員が VPC 全体を使用するのであれば、VPC をリソース・グループに分割する必要はないでしょう。 _OpenStack_ に詳しい人であれば、_OpenStack Keystone_ の_プロジェクト_ の概念に近いものがリソース・グループであると考えることができます。

VPC の作成時にしか、リソースをリソース・グループに割り当てることはできません。 リソースを作成した後に、リソース・グループを変更することはできません。
{: .note}

リソース・グループは、主に大規模組織向けに設計された機能です。 ほとんどの会社やチームでは、VPC の境界がリソースの分割線になります。 この大まかな経験則が変わってくるのは、個々の VSI (インスタンス) をリソース・グループに割り当て、個々のユーザーを VSI (インスタンス) リソースに割り当てることができる場合です。

IBM Cloud VPC のセットアップ時にリソース・グループを使用する場合は、組織内のリソースやユーザーをどのように各リソース・グループに割り当てるかを事前に計画しておくと良いでしょう。
{: tip}

## VPC の詳細
{: #specifics-for-vpc}

VPC インフラストラクチャーのリソースには、使用法を制御する許可ポリシーをアカウントまたは親 VPC から継承するものもあれば、個別にポリシーを持つものもあります。


### リソース・タイプ別の VPC リソース権限
{: #vpc-resource-authorization-by-resource-type}

VPC リソースのデフォルトの権限を以下の表にまとめます。

| リソースのタイプ | デフォルトの権限を取得する場所 |
|-----------|------------|
| VPC | 作成時の許可検査 |
| ロード・バランサー | 作成時の許可検査 |
| VPN | 作成時の許可検査 |
| サブネット | 親 VPC |
| パブリック・ゲートウェイ | 親 VPC |
| インスタンス | 作成時の許可検査 |
| セキュリティー・グループ | 作成時の許可検査 |
| キー | 作成時の許可検査 |
| イメージ | アカウント |
| 浮動 IP | アカウント |
| ネットワーク ACL | アカウント|
| ボリューム | 作成時の許可検査 |

浮動 IP とネットワーク ACL は、アカウント・レベルで (まだ割り当てられていない) 範囲を指定して作成できます。ただし、インスタンスに割り当てられた浮動 IP、または、サブネットに割り当てられた ACL は、割り当て後すぐに VPC の権限範囲の対象になります。
{: note}

### VPC の役割の対象範囲およびリソースに対して許可される操作
{: #vpc-coverage-of-roles-and-authorized-actions-on-resources}

2 つの VPC が存在するシナリオで、特定の役割を持つユーザーが特定の操作を実行した場合の結果について、以下に例をいくつか示します。

* すべてのリソースに対する**管理者**権限を持つユーザー _admin_
  * `vpc1` の作成: ok

* すべてのリソースに対する**エディター**権限を持つユーザー _editor_
  * `vpc2` の作成: ok
  * `vpc2` の更新: ok
  * `vpc2` の削除: ok

* すべてのリソースに対する**オペレーター**権限を持つユーザー _operator_
  * `vpc` の作成: 拒否
  * `vpc1` の更新: 拒否
  * `vpc1` の削除: 拒否

* すべてのリソースに対する**ビューアー**権限を持つユーザー _viewer_
  * VPC のリスト表示: [vpc1] が表示される
  * `vpc1` の読み取り: ok

* ポリシーのないユーザー _noRole_
  * VPC のリスト表示: [] が表示される
  * `vpc1` の読み取り: 拒否

### VPC の対象範囲の要約表
{: #vpc-coverage-summary-table}

役割 (管理者、エディター、オペレーター、ビューアー) を基準にしてアクセス権限を与えるポリシーでは、以下の操作が許可されます (X=拒否、o=OK)。

 役割:      | なし | ビューアー | オペレーター | エディター | 管理者
-----------:|------|--------|-------|--------|-------
作成      | X    | X      | X     | o      | o
リスト表示        | X    | o      | X     | o      | o
読み取り        | X    | o      | X     | o      | o
更新      | X    | X      | X     | o      | o
削除      | X    | X      | X     | o      | o


## VPC の VPN のリソース権限
{: #resource-authorizations-of-vpn-for-vpc}

**VPC の VPN** のリソース権限は、他のタイプの VPC リソースの権限とは別にセットアップしますが、方法は似ています。

VPC の VPN のポリシーは、VPN リソース (特に VPN ゲートウェイ) へのアクセスを制御します。VPN ゲートウェイの子リソース (VPN 接続やローカルまたはピア CIDR など) にアクセスするには、親 VPN ゲートウェイに対する**読み取り**権限 (以上) が必要です。リソース・ポリシーは、親 VPN ゲートウェイに対しても **読み取り**以上の権限を持つ VPN 接続でのみ使用できます。以下を VPN のリソース・ポリシーのターゲットにすることができます。

* すべての VPN リソース (VPN ゲートウェイ、VPN 接続、IKE ポリシーおよび IPsec ポリシー)
* リソース・グループ内のすべての VPN リソース
* 1 つの VPN ゲートウェイ

VPN の使用料は別途課金されます。
{: note}

### VPC の VPN の役割の対象範囲およびリソースに対して許可される操作
{: #vpn-for-vpc-coverage-of-roles-and-authorized-actions-on-resources}

サポートされるユーザー役割は VPC のリソース権限の場合と同じですが、各役割で実行できる操作は異なります。

特定の役割を持つユーザーが VPN 関連の特定の操作を実行した場合の結果について、以下に例をいくつか示します。

* すべてのリソースに対する**管理者**権限を持つユーザー _admin_
  * VPN ゲートウェイの作成、更新、削除、読み取り、リスト表示: ok
  * VPN 接続の作成、更新、削除、読み取り、リスト表示: ok
  * VPN 接続のピア & ローカル CIDR の作成、更新、削除、読み取り、リスト表示: ok
  * IKE ポリシーの作成、更新、削除、読み取り、リスト表示: ok
  * IPSec ポリシーの作成、更新、削除、読み取り、リスト表示: ok

* すべてのリソースに対する**エディター**権限を持つユーザー _editor_
  * 管理者の場合と同じ

* すべてのリソースに対する**オペレーター**権限を持つユーザー _operator_
  * VPN ゲートウェイの作成、更新、削除: 拒否
  * VPN 接続の作成、更新、削除: 拒否
  * VPN 接続のピア & ローカル CIDR の作成、更新、削除: 拒否
  * IKE ポリシーの作成、更新、削除: 拒否
  * IPSec ポリシーの作成、更新、削除: 拒否
  * VPN ゲートウェイの読み取り、リスト表示: ok - 実際のデータが表示される
  * VPN 接続の読み取り、リスト表示: ok - 実際のデータが表示される
  * VPN 接続のピア & ローカル CIDR の読み取り、リスト表示: ok - 実際のデータが表示される
  * IKE ポリシーの読み取り、リスト表示: ok - 実際のデータが表示される
  * IPSec ポリシーの読み取り、リスト表示: ok - 実際のデータが表示される

* すべてのリソースに対する**ビューアー**権限を持つユーザー _viewer_
  * オペレーターの場合と同じ

* ポリシーのないユーザー _noRole_
  * VPN ゲートウェイの読み取り、リスト表示: 拒否 - 空のデータがリストに表示される
  * VPN 接続の読み取り、リスト表示: 拒否
  * VPN 接続のピア & ローカル CIDR の読み取り、リスト表示: 拒否
  * IKE ポリシーの読み取り、リスト表示: 拒否 - 空のデータがリストに表示される
  * IPSec ポリシーの読み取り、リスト表示: 拒否 - 空のデータがリストに表示される

### VPC の VPN の対象範囲の要約表
{: #vpn-for-vpc-coverage-summary-table}

VPC の VPN の操作と役割の対応関係は、以下の表で表せます (X=拒否、o=OK)。

役割:       | なし | ビューアー | オペレーター | エディター | 管理者
-----------:|------|--------|-------|--------|-------
作成      | X    | X      | X     | o      | o
リスト表示        | X    | o      | o     | o      | o
読み取り        | X    | o      | o     | o      | o
更新      | X    | X      | X     | o      | o
削除      | X    | X      | X     | o      | o

## VPC のロード・バランサーに対するリソース権限
{: #resource-authorization-for-load-balancer-for-vpc}

**VPC のロード・バランサー**を使用するためのリソース権限は、VPC の他のリソース権限とは別にセットアップしますが、方法は似ています。

ロード・バランサーの使用料は別途課金されます。
{: note}

### ロード・バランサーの役割の対象範囲およびリソースに対して許可される操作
{: #load-balancer-coverage-of-roles-and-authorized-actions-on-resources}

特定の役割を持つユーザーが VPC ロード・バランサー関連の特定の操作を実行した場合の結果について、以下に例をいくつか示します。

* すべてのリソースに対する**管理者**権限を持つユーザー _admin_
  * ロード・バランサーの作成、更新、削除、読み取り、リスト表示: ok
  * リスナーの作成、更新、削除、読み取り、リスト表示: ok
  * プールの作成、更新、削除、読み取り、リスト表示: ok
  * メンバーの作成、更新、削除、読み取り、リスト表示: ok
  * ロード・バランサー統計の作成、更新、削除、読み取り、リスト表示: ok

* すべてのリソースに対する**エディター**権限を持つユーザー _editor_
  * 管理者の場合と同じ

* すべてのリソースに対する**オペレーター**権限を持つユーザー _operator_
  * ロード・バランサーの作成、更新、削除、読み取り、リスト表示: 拒否
  * リスナーの作成、更新、削除、読み取り、リスト表示: 拒否
  * プールの作成、更新、削除、読み取り、リスト表示: 拒否
  * メンバーの作成、更新、削除、読み取り、リスト表示: 拒否
  * ロード・バランサー統計の作成、更新、削除、読み取り、リスト表示: 拒否

* すべてのリソースに対する**ビューアー**権限を持つユーザー _viewer_
  * ロード・バランサーの読み取り、リスト表示: ok
  * リスナーの読み取り、リスト表示: ok
  * プールの読み取り、リスト表示: ok
  * メンバーの読み取り、リスト表示: ok
  * ロード・バランサー統計の読み取り: ok

* ポリシーのないユーザー _noRole_
  * ロード・バランサーの読み取り、リスト表示: 拒否 - 空のデータが表示される
  * リスナーの読み取り、リスト表示: 拒否
  * プールの読み取り、リスト表示: 拒否
  * メンバーの読み取り、リスト表示: 拒否
  * ロード・バランサー統計の読み取り: 拒否

### ロード・バランサーの対象範囲の要約表
{: #load-balancer-coverage-summary-table}

VPC のロード・バランサーの操作と役割の対応関係は、以下の表で表せます (X=拒否、o=OK)。

役割:       | なし | ビューアー | オペレーター | エディター | 管理者
-----------:|------|--------|-------|--------|-------
作成      | X    | X      | X     | o      | o
リスト表示        | X    | o      | X     | o      | o
読み取り        | X    | o      | X     | o      | o
更新      | X    | X      | X     | o      | o
削除      | X    | X      | X     | o      | o


## VPC の仮想サーバーに対するリソース権限
{: #planning-virtual-servers-for-vpc-permissions}

VPC 内の他のリソース権限とは別に、**VPC の仮想サーバー**に対するリソース権限を設定します。 

VPC の仮想サーバーの使用については、別途課金されます。
{: note}

* 管理者は、役割の定義、{{site.data.keyword.vsi_is_short}} に対するあらゆる操作を実行できます。
* エディターは、状態の変更、サブリソースの作成/削除を実行できます。
* オペレーターは、リソースの状態を変更しない操作を実行できます。
* ビューアーは、リソースの状態を変更しない操作を実行できます。

### 仮想サーバーの対象範囲の要約表
{: #vsi-coverage-summary-table}

VPC の仮想サーバーの操作と役割の対応関係を、以下の表に示します (X=実行不可、o=OK)。

役割:       | なし | ビューアー | オペレーター | エディター | 管理者
-----------:|------|--------|-------|--------|-------
作成      | X    | X      | X     | o      | o
リスト表示        | X    | o      | o     | o      | o
読み取り        | X    | o      | o     | o      | o
更新      | X    | X      | X     | o      | o
削除      | X    | X      | X     | o      | o

インスタンスを作成するときに VPC リソースおよびセキュリティー・グループ・リソースを指定する場合は、それらのリソースに対するオペレーター権限も必要です。サブネット・リソースおよび浮動 IP リソースは、関連する VPC から許可を継承します。  
{: tip} 
