---

copyright:
  years: 2019
lastupdated: "2019-05-29"


keywords: vpc, delete, resources

subcollection: vpc-on-classic
---

{:shortdesc: .shortdesc}
{:new_window: target="_blank"}
{:codeblock: .codeblock}
{:pre: .pre}
{:pre: .pre}
{:screen: .screen}
{:tip: .tip}
{:important: .important}
{:note: .note}
{:download: .download}
{:DomainName: data-hd-keyref="DomainName"}

# VPC の削除
{: #deleting}

{{site.data.keyword.cloud}} 仮想プライベート・クラウド・リソースは、他のリソースが含まれている場合や別のリソースに接続されている場合には削除できません。この資料では、VPC リソース間の関係について説明し、VPC を削除する方法に関するベスト・プラクティスを紹介します。

以下の表では、VPC リソースのタイプ、およびそれらのリソースを削除する際に考慮する必要のある関係を要約しています。

| リソース | 削除前に必要な操作 | 削除後に行われる操作 |
| ---------------- | ----------------------------------------- | --------------------------- |
| VPC | VPC 内のすべてのサブネットとパブリック・ゲートウェイを削除する必要がある | すべてのセキュリティー・グループとアドレス接頭部が自動的に削除される |
| サブネット | サブネット内のすべてのインスタンスとネットワーク・インターフェースを削除する必要がある。サブネット内のすべての VPN ゲートウェイとロード・バランサーを削除する必要がある | サブネットにサービスを提供するすべてのパブリック・ゲートウェイが切り離される。サブネットに関連付けられているすべてのネットワーク ACL が切り離される |
| インスタンス | ---- | すべてのネットワーク・インターフェースが自動的に削除される。ブート・ボリュームはインスタンスとともに削除される。2 次ボリュームの削除は `delete_volume_on_instance_delete` パラメーターに依存する。いずれかのネットワーク・インターフェースに接続されているフローティング IPは、すべて自動的に切り離される |
| ネットワーク・インターフェース | ---- | ネットワーク・インターフェースに接続された浮動 IP がすべて解放される |
| キー | ---- | 鍵を削除した後は、その鍵を使用した新規インスタンスのプロビジョンや既存のインスタンスでの OS の再ロードができなくなる。ただし、その鍵は、その鍵を使用してプロビジョンしたインスタンスで引き続き使用でき、ログインにも使用できる。|
| イメージ | ---- | イメージを使用して新規インスタンスをプロビジョンできなくなる。ただし、そのイメージを持つ既存のインスタンスには影響がない。|
| ボリューム | ボリュームをすべてのインスタンスから切り離す必要がある | ---- |
| ネットワーク ACL | ネットワーク ACL はすべてのサブネットから切り離す必要がある。VPC のデフォルト・ネットワーク ACL は削除できない | ---- |
| セキュリティー・グループ | セキュリティー・グループをすべてのネットワーク・インターフェースから切り離す必要がある。VPC のデフォルト・セキュリティー・グループは削除できない。 | ---- |
| 浮動 IP | 浮動 IP をすべてのネットワーク・インターフェースから切り離す必要がある | ---- |
| パブリック・ゲートウェイ | パブリック・ゲートウェイをすべてのサブネットから切り離す必要がある |  ---- |
| ロード・バランサー | ---- | ---- |
| VPN ゲートウェイ | ---- | IKE & IPsec ポリシーは複数のゲートウェイ間で共有できるため、VPN ゲートウェイの削除時にこれらのポリシーは削除されない。IKE & IPsec ポリシーは手動で削除する必要がある。|


## VPC リソースは過渡状態のときに削除できない
{: #deleting-status}

VPC リソースは、`pending` などの過渡状態にあるときには削除できません。いずれのリソースも、削除するには「最終」状態 (`available` や `failed` など) になっている必要があります。リソースの削除を試行する前に、リソースが `available` または `failed` になるまで待つ必要があります。リソースの状況が 30 分以内に `available` や `failed` にならない場合は、[サポートにお問い合わせください](/docs/vpc-on-classic?topic=vpc-on-classic-getting-help-and-support)。

リソースの削除要求を発行すると、リソースは過渡状態の `deleting` になります。親リソースまたは接続されたリソースの削除を試行する前に、リソースがリストから消えるまで待ちます。場合によっては、削除操作が失敗することがあります。このとき、リソースは数分以内に `failed` 状況になります。削除要求を行ってから 30 分経っても、リソースがリストに表示されたままで、`failed` 状況にもならない場合は、サポートにお問い合わせください。リソースが `failed` 状況になった後に、リソースの削除を再試行できます。`failed` 状況のリソースを削除できない場合は、[サポートにお問い合わせください](/docs/vpc-on-classic?topic=vpc-on-classic-getting-help-and-support)。

## VPC を削除する順序
{: #deleting-order}

VPC にはサブネットとパブリック・ゲートウェイが含まれます。パブリック・ゲートウェイは、VPC 内の 1 つ以上のサブネットに接続できます。ロード・バランサーと VPN ゲートウェイは、VPC のサブネット内に存在します。サブネットには仮想サーバー・インスタンス (VSI) が含まれることもあります。1 つの VSI は VPC 内の異なるサブネットに複数のネットワーク・インターフェースを持つことができます。サブネットを削除するには、その前に、サブネット内の VPN ゲートウェイ、ロード・バランサー、およびネットワーク・インターフェースを削除する必要があります。VPC にはセキュリティー・グループも含まれますが、それらは VPC が削除されるときに自動的に削除されます。アドレス接頭部は VPC の属性であり、それらは VPC が削除されるときに自動的に削除されます。

VPC を削除する際には、以下の順序に従います。

1.  VPC のいずれかのサブネットでプロビジョンされたすべての VPN ゲートウェイを削除します。
2.  VPC のいずれかのサブネットでプロビジョンされたすべてのロード・バランサーを切り離します。
3.  VPC のいずれかのサブネット内にネットワーク・インターフェースがあるすべてのインスタンスを削除します。ネットワーク・インターフェースに関連付けられた浮動 IP は、インスタンスが削除されると、自動的にネットワーク・インターフェースから切り離されます。
4.  VPC 内のすべてのサブネットを削除します。サブネットに接続されたすべてのパブリック・ゲートウェイは、サブネットが削除されると自動的にサブネットから切り離されます。
5.  VPC 内のパブリック・ゲートウェイをすべて削除します。
6.  VPC にサブネットもパブリック・ゲートウェイもなくなると、VPC を削除できるようになります。VPC 内のすべてのアドレス接頭部は、VPC が削除されるときに自動的に削除されます。

## VPC リソースの関係
{: #deleting-relationships}

一部の VPC リソースは他の VPC リソース内に (「子」として) 含まれていますが、他の VPC リソースは特定の VPC の外部のアカウント・レベルに含まれています。親リソースを削除するには、その前に、すべての子 VPC リソースを削除する必要があります。アカウント・レベルの VPC リソースの場合、アカウント・リソースを削除するには、その前に、既存のリソースへのすべてのリンクを削除する必要があります。

一部のケースでは、VPC リソースを削除すると、既存のリソースへのリンクが自動的に削除されます。以下の表では、予期される動作について説明しています。

### VPC
{: #deleting-details}

VPC にはサブネットとパブリック・ゲートウェイが含まれます。ロード・バランサー、VPN ゲートウェイ、およびインスタンスがサブネット内でプロビジョンされます。VPC を削除するには、その前に、VPC 内のすべてのサブネットおよびすべてのパブリック・ゲートウェイを削除する必要があります。つまり、VPC 内のすべてのパブリック・ゲートウェイ、ロード・バランサー、VPN ゲートウェイ、およびインスタンスをまず削除する必要があります。

VPC には、アドレス接頭部とセキュリティー・グループも含まれますが、これらのリソースは VPC が削除されるときに自動的に削除されます。

VPC には、デフォルトのセキュリティー・グループとデフォルトのネットワーク ACL が必要です。デフォルトのセキュリティー・グループとネットワーク ACL を指定しないで VPC を作成した場合には、デフォルトのセキュリティー・グループとネットワーク ACL が VPC 用に自動的に作成されます。デフォルトのセキュリティー・グループとデフォルトのネットワーク ACL は削除できません。VPC が削除されるときに、デフォルトのネットワーク ACL は自動的に削除されます。VPC が削除されると、VPC 内のすべてのセキュリティー・グループが自動的に削除されます。

| VPC 内の要素 | 含めることができるもの | 接続可能なもの | 状況の有無 | VPC の削除時に自動的に削除 | 削除時に自動的に切り離し |
| ---------------- | ----------------------------------------- | --------------------------- | ------ | ---------------------------------------------- | ----------------------------------- |
| サブネット | インスタンス、ロード・バランサー、VPN ゲートウェイ | パブリック・ゲートウェイ、ネットワーク ACL | はい| いいえ | はい|
| パブリック・ゲートウェイ | --- | サブネット、浮動 IP | はい | いいえ | サブネットは「いいえ」、浮動 IP は「はい」|
| セキュリティー・グループ | ---  | インスタンス (NIC)、デフォルトで VPC | いいえ| はい | いいえ |

### サブネット
{: #deleting-subnet}

サブネットを削除するには、その前に、サブネット内のすべてのリソースを削除する必要があります。サブネットには、インスタンスのネットワーク・インターフェース、ロード・バランサー、および VPN ゲートウェイが含まれます。サブネットを削除するには、その前に、サブネットに関連付けられたネットワーク・インターフェースを、サブネット内にプロビジョンされたロード・バランサーや VPN ゲートウェイと共に削除する必要があります。

インスタンスには、VPC の複数のサブネットに属する複数のネットワーク・インターフェースが含まれている場合があります。サブネットを削除するには、その前に、サブネット内のすべてのネットワーク・インターフェースを削除する必要があります。インスタンスの 1 次ネットワーク・インターフェースは削除したり別のサブネットに移動したりできないので、サブネットを削除するには、その前に、サブネット内の 1 次ネットワーク・インターフェースを持つすべてのインスタンスを削除する必要があります。


| サブネット内の要素 | 含めることができるもの | 接続可能なもの | 状況の有無 | サブネットの削除時に自動的に削除 | 削除時に自動的に切り離し |
| ---------------- | ----------------------------------------- | --------------------------- | ------ | ---------------------------------------------- | ----------------------------------- |
| インスタンス (ネットワーク・インターフェース) | 複数のネットワーク・インターフェース | ボリューム接続、セキュリティー・グループ | はい| いいえ  | はい|
| VPN | --- | ---| はい | いいえ  | --- |
| ロード・バランサー | ---  | --- | はい | いいえ | ---  |

### インスタンス
{: #deleting-instance}

インスタンスを削除するために必要な前提条件はありません。インスタンスが削除されると、そのすべてのネットワーク・インターフェースが自動的に削除されます。インスタンスのブート・ボリュームとそのすべてのボリューム接続が削除されます。そのいずれかのネットワーク・インターフェースに接続されたすべての浮動 IP は、自動的に解放されます。ボリュームがフラグ `delete_volume_on_instance_delete` を true に設定して作成された場合、インスタンスに接続されたすべてのブロック・ストレージ・ボリュームは自動的に削除されます。そうでない場合は、インスタンスはボリュームから切り離されますが、ボリュームは存続します。いずれかのセキュリティー・グループがインスタンスのネットワーク・インターフェースに接続されている場合、そのネットワーク・インターフェースが削除されると、セキュリティー・グループも自動的に切り離されます。

| インスタンス内の要素 | 含めることができるもの | 接続可能なもの | 状況の有無 | インスタンスの削除時に自動的に削除 | 削除時に自動的に切り離し |
| ---------------- | ----------------------------------------- | --------------------------- | ------ | ---------------------------------------------- | ----------------------------------- |
| ネットワーク・インターフェース | --- | サブネット、浮動 IP、セキュリティー・グループ | いいえ | はい | はい |

### ロード・バランサー
{: #deleting-lb}

ロード・バランサーを削除するために必要な前提条件はありません。ロード・バランサーが削除されると、ロード・バランサーの一部であるすべてのリスナー、プール、およびプール・メンバーが自動的に削除されます。

ロード・バランサーの削除には、最大で 30 分かかる場合があります。削除要求により、ロード・バランサーのプロビジョン状況が即時に `deleting` に変更されます。ただし、リスト照会にロード・バランサーが表示されなくなるまでは、実際には削除されていません。
{: important}

### VPN
{: #deleting-vpn}

VPN ゲートウェイを削除するために必要な前提条件はありません。VPN ゲートウェイが削除されると、関連付けられている接続も自動的に削除されます。VPN ゲートウェイが削除されても、IKE ポリシーや IPSec ポリシーは削除されません。

VPN ゲートウェイの削除には、最大で 30 分かかる場合があります。削除要求により、VPN ゲートウェイのプロビジョン状況が即時に `deleting` に変更されます。ただし、リスト照会に VPN ゲートウェイが表示されなくなるまでは、実際には削除されていません。
{: important}

### 浮動 IP
{: #deleting-floating-ip}

浮動 IP は、アカウント・レベルで VPC の外部に存在します。浮動 IP がパブリック・ゲートウェイまたはインスタンスにバインドされている場合、フローティング IP を削除するには、その前にリンクを削除する (解除する) 必要があります。

浮動 IP がバインドされているリソースを削除すると (例えば、インスタンスのネットワーク・インターフェースを削除する場合など)、その浮動 IP は自動的に解除されます。

### ボリューム
{: #deleting-volume}

VPC には、ブロック・ストレージ・ブート・ボリュームとブロック・ストレージ・データ・ボリュームの 2 つのタイプのボリュームを含めることができます。これらのボリュームは、それぞれ異なる方法で削除されます。

**ブート・ボリュームの削除**

ブート・ボリュームは、インスタンス内に存在し、そのインスタンスとは別個のエンティティーとは見なされません。インスタンスを作成すると、ブート・ボリュームも作成されて、そのインスタンスに接続されます。インスタンスを削除すると、ブート・ボリュームは自動的に削除されます。インスタンスを削除しないでブート・ボリュームを削除することはできません。

**データ・ボリュームの削除**

ブロック・ストレージ・データ・ボリュームは、それらが関連付けられている仮想サーバー・インスタンスとは別にプロビジョンおよび管理できます。データ・ボリュームを 2 次ストレージとして 1 つの仮想サーバー・インスタンスに接続できます。インスタンスに接続されているデータ・ボリューム (つまりボリュームが「アクティブ」の場合) は、削除できません。最初にインスタンスからボリュームを切り離す必要があります。その後、ボリュームを削除できます。

データ・ボリュームには、API に `delete_volume_on_instance_delete`、CLI および UI に `Auto Delete` という属性 (またはフラグ) があります。このフラグが `true` (UI では `Enabled`) に設定されている場合、ボリュームが接続されているインスタンスが削除されると、そのボリュームは自動的に切り離されて削除されます。ボリュームのフラグが `false` (UI では `Disabled`) に設定されている場合、インスタンスはボリュームから切り離されますが、接続されているインスタンスが削除されてもボリュームは削除されません。そのボリュームは別のインスタンスに接続することができます。

ブロック・ストレージ・ボリュームは、一度に 1 つの仮想サーバーにのみ接続できます。
{: tip}

### セキュリティー・グループ
{: #deleting-secgroup}

セキュリティー・グループは、それがネットワーク・インターフェースによって使用されている場合や VPC のデフォルトのセキュリティー・グループである場合には削除できません。セキュリティー・グループを削除する前に、そのセキュリティー・グループからすべてのネットワーク・インターフェースを削除し、そのセキュリティー・グループが VPC のデフォルト・セキュリティー・グループとして使用されていないことを確認してください。

VPC を削除すると、その VPC 内のすべてのセキュリティー・グループが自動的に削除されます。

### ネットワーク ACL
{: #deleting-netacl}

ネットワーク ACL は、それがサブネットによって使用されている場合や VPC のデフォルト・ネットワーク ACL である場合には削除できません。ネットワーク ACL を削除する前に、そのネットワーク ACL をすべてのサブネットから切り離し、そのネットワーク ACL が VPC のデフォルト・ネットワーク ACL として使用されていないことを確認してください。

VPC が作成されるときには、デフォルトのネットワーク ACL が必要です。VPC の作成時に既存のネットワーク ACL がデフォルトとして指定されない場合は、新しいネットワーク ACL が作成されて、デフォルトとして設定されます。このデフォルトのネットワーク ACL は、その ACL が他の場所で使用されていなければ、VPC の削除時に自動的に削除されます。

セキュリティー・グループとは異なり、ネットワーク ACL は複数の VPC に渡って割り当てることができます。そのため、VPC を削除してもネットワーク ACL は削除されません。
{: note}

## 次のステップ
{: #deleting-nextsteps}

以下のトピックでは、IBM Cloud コンソール、コマンド・ライン・インターフェース、または API を使用して、VPC リソースを削除する方法の例を示しています。

-   [UI を使用した VPC リソースの削除](/docs/vpc-on-classic?topic=vpc-on-classic-deleting-using-console)
-   [CLI を使用した VPC リソースの削除](/docs/vpc-on-classic?topic=vpc-on-classic-deleting-using-cli)
-   [API を使用した VPC リソースの削除](/docs/vpc-on-classic?topic=vpc-on-classic-deleting-using-api)
