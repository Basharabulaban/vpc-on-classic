---

copyright:
  years: 2019
lastupdated: "2019-05-17"


keywords: vpc, delete, resources, cli, rias, infrastructure

subcollection: vpc-on-classic

---

{:shortdesc: .shortdesc}
{:new_window: target="_blank"}
{:codeblock: .codeblock}
{:pre: .pre}
{:screen: .screen}
{:tip: .tip}
{:important: .important}
{:note: .note}
{:download: .download}
{:DomainName: data-hd-keyref="DomainName"}

# IBM Cloud CLI を使用した VPC の削除
{: #deleting-using-cli}

このトピックでは、{{site.data.keyword.cloud}} 仮想プライベート・クラウドから、推奨される順序で VPC のすべてのリソースを削除する方法の例を示します。 

削除に関して留意すべき重要な事項を以下に示します。

* VPC は空になっていないと削除できません。 
* 親リソースを削除する前に、含まれているリソースをすべて正常に削除する必要があります。 
* リソースの削除が進行中の場合は、リスト照会を行うと `deleting` 状況が表示されます。 
* ほとんどの削除要求は_非同期_ です。つまり、リソースの削除が完了するまで、リスト照会では **deleting** 状況が表示される可能性があります。 
* リストに子リソースが表示されなくなったことを確認してから、親リソースを削除する必要があります。 

リソースの状況が `delete` から `failed` に変わった場合は、リソースの削除を再試行できます。`failed` 状況のリソースを削除できない場合は、[サポートにお問い合わせください](/docs/vpc-on-classic?topic=vpc-on-classic-getting-help-and-support)。
{: tip}

## 手順 1: 削除する VPC のすべてのサブネットを確認する
{: #deleting-find-subnets-cli}

VPC を削除する前に、その VPC の各サブネットを削除する必要があります。次のコマンドを実行し、`ID` 値を参照して、削除する VPC の ID を確認します。

```
ibmcloud is vpcs
```
{: pre}

後で利用できるように、VPC の ID を変数に保存します。次に例を示します。

```
vpc="3524fef5-da35-4622-bf9a-31614964649d"
```
{: pre}

アカウント内のすべてのサブネットのリストを取得するために、次のコマンドを実行します。

```
ibmcloud is subnets
```
{: pre}

`VPC` 値を参照して、削除する必要があるサブネットを確認します。後で利用できるように、サブネットの ID を変数に保存します。次に例を示します。

```
subnet="d31ce469-9b0f-44e1-87ce-0fc77d8b0e53"
```
{: pre}

削除する VPC に複数のサブネットがある場合は、すべてのサブネットを削除するために、この手順を繰り返してください。
{: important}

## 手順 2: VPC 内の各サブネットを削除する
{: #deleting-subnet-resources-cli}

### サブネット内のすべての VPN ゲートウェイを削除する (存在する場合)

アカウント内のすべての VPN ゲートウェイをリストするために、次のコマンドを実行します。

```
ibmcloud is vpn-gateways
```
{: pre}

削除するサブネット内の VPN ゲートウェイごとに、次のコマンドを実行します。`$vpnid` は VPN ゲートウェイの ID です。

```
ibmcloud is vpn-gateway-delete $vpnid
```

すぐに VPN ゲートウェイの状況が `deleting` に変わるはずですが、リスト照会結果にはまだ表示されるはずです。VPN ゲートウェイの削除には、最大で 30 分かかる場合があります。
{: note}

VPN ゲートウェイの削除を待つ間に、他のサブネット・リソースの削除を並行して要求できます。しかし、サブネットの削除は、リスト照会結果にそのサブネット内の VPN ゲートウェイとその他のすべてのリソースが表示されなくなるまで実行できません。

### サブネット内のすべてのロード・バランサーを削除する (存在する場合)
{: #deleting-lbs-cli}

アカウント内のすべてのロード・バランサーをリストするために、次のコマンドを実行します。

```
ibmcloud is load-balancers
```
{: pre}

削除するサブネット内のロード・バランサーごとに、次のコマンドを実行します。`$lbid` はロード・バランサーの ID です。

```
ibmcloud is load-balancer-delete $lbid
```
{: pre}

すぐにロード・バランサーの状況が `deleting` に変わるはずですが、リスト照会結果にはまだ表示されるはずです。ロード・バランサーの削除には、最大で 30 分かかる場合があります。
{: note}

ロード・バランサーの削除を待つ間に、他のサブネット・リソースの削除を並行して要求できます。しかし、サブネットの削除は、リスト照会結果にそのサブネット内のロード・バランサーとその他のすべてのリソースが表示されなくなるまで実行できません。

### サブネット内のすべてのネットワーク・インターフェースを削除する (存在する場合)
{: #deleting-nics-cli}

インスタンスには、VPC の複数のサブネットに属する複数のネットワーク・インターフェースが含まれている場合があります。サブネットを削除するには、その前に、サブネット内のすべてのネットワーク・インターフェースを削除する必要があります。 

サブネット内のネットワーク・インターフェースを削除するには、そのインスタンスを削除するしかありません。
{: note}

アカウント内のすべてのインスタンスをリストするために、次のコマンドを実行します。

```
ibmcloud is instances
```
{: pre}

VPC 内のインスタンスをすべて削除する場合は、VPC 内のインスタンスごとに次のコマンドを実行します。`$vsi` は削除するインスタンスの ID です。インスタンスを削除すると、他のサブネットのネットワーク・インターフェースが (ある場合) すべて自動的に削除されます。

```
ibmcloud is instance-delete $vsi
```
{: pre}

すぐにインスタンスの状況が `deleting` に変わるはずですが、リスト照会結果にはまだ表示されるはずです。インスタンスの削除には、最大で 30 分かかる場合があります。
{: note}

インスタンスの削除を待つ間に、他のサブネット・リソースの削除を並行して要求できます。しかし、サブネットの削除は、リスト照会結果にそのサブネット内のインスタンスとその他のすべてのリソースが表示されなくなるまで実行できません。

インスタンスのネットワーク・インターフェースをすべてリストするために、次のコマンドを実行します。

```
ibmcloud is instance-network-interfaces $vsi
```
{: pre}

削除するサブネット内に 2 次ネットワーク・インターフェースがある場合は、そのインスタンスを削除する必要があります。インスタンスを削除せずにネットワーク・インターフェースをインスタンスから削除することはできません。

### サブネットを削除する
{: #deleting-subnet-cli}

サブネット内のリソースがすべて削除され、リスト照会結果に戻されなくなったら、次のコマンドを実行してサブネットを削除します。

```
ibmcloud is subnet-delete $subnet
```
{: pre}

すぐにサブネットの状況が `deleting` に変わるはずですが、サブネットが実際に削除されてリスト照会結果に表示されなくなるまでは、数分かかる可能性があります。

## 手順 3: VPC 内のすべてのパブリック・ゲートウェイを削除する (存在する場合)
{: #deleting-pgs-cli}

アカウント内のすべてのパブリック・ゲートウェイをリストするために、次のコマンドを実行します。

```
ibmcloud is public-gateways
```
{: pre}

削除する VPC 内のパブリック・ゲートウェイごとに、次のコマンドを実行してパブリック・ゲートウェイを削除します。`$gateway` はパブリック・ゲートウェイの ID です。

```
ibmcloud is public-gateway-delete $gateway
```
{: pre}


## 手順 4: VPC を削除する
{: #deleting-single-vpc-cli}

VPC 内のサブネット、VPN ゲートウェイ、ロード・バランサー、パブリック・ゲートウェイをすべて削除したら、次のコマンドを実行して VPC を削除します。`$vpc` は削除する VPC の ID です。

```
ibmcloud is vpc-delete $vpc
```
{: pre}

すぐに VPC の状況が `deleting` に変わるはずですが、VPC が実際に削除されてリスト照会結果に表示されなくなるまでは、数分かかる可能性があります。
