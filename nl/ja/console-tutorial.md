---

copyright:
  years: 2018, 2019
lastupdated: "2019-05-17"

keywords: create, configure, permissions, ACL, virtual, server, instance, subnet, block, storage, volume, security, group, images, Windows, Linux, example, monitoring, VPN, load balancer, IKE, IPsec

subcollection: vpc-on-classic

---

{:shortdesc: .shortdesc}
{:new_window: target="_blank"}
{:codeblock: .codeblock}
{:pre: .pre}
{:screen: .screen}
{:tip: .tip}
{:important: .important}
{:download: .download}
{:DomainName: data-hd-keyref="DomainName"}

# {{site.data.keyword.cloud_notm}} コンソールを使用した VPC の作成
{: #creating-a-vpc-using-the-ibm-cloud-console}
[comment]: # (リンクされたヘルプ・トピック)

本資料では、{{site.data.keyword.cloud_notm}} コンソールを使用して {{site.data.keyword.cloud}} 仮想プライベート・クラウドを作成および構成する方法について説明します。

仮想プライベート・クラウド (VPC) とその他の接続リソースを作成および構成するには、この後に続くセクションのステップを以下の順序で実行します。

1. VPC、およびネットワークを定義するサブネットを作成します。サブネットを作成するときには、パブリック・ゲートウェイを接続して、サブネット内のすべてのリソースがパブリック・インターネットと通信できるようにします。
1. アクセス制御リスト (ACL) を構成して、サブネットのインバウンドとアウトバウンドのトラフィックを制限します。 デフォルトでは、すべてのトラフィックが許可されます。
1. 仮想サーバー・インスタンスを作成します。
1. ブロック・ストレージ・ボリュームを作成し、インスタンスに接続します。
1. セキュリティー・グループを構成して、インスタンスで許可されるインバウンドとアウトバウンドのトラフィックを定義します。
1. 浮動 IP アドレスを予約および関連付けして、インターネットからインスタンスに接続できるようにします。
1. ロード・バランサーを作成して、複数インスタンスに要求を分散させます。
1. 仮想プライベート・ネットワーク (VPN) を作成して、VPC を別のプライベート・ネットワーク (オンプレミス・ネットワークや別の VPC など) に安全に接続できるようにします。

## 始める前に
{: #before}
VPC でリソースを作成および管理するための十分な許可が付与されていることを確認してください。 詳しくは、[VPC リソースに対するユーザー許可の管理](/docs/vpc-on-classic?topic=vpc-on-classic-managing-user-permissions-for-vpc-resources)を参照してください。

仮想サーバー・インスタンスへの接続に使用する SSH 鍵を生成します。 例えば、Linux サーバーで SSH 鍵を生成するには、コマンド `ssh-keygen -t rsa -C"user_ID "` を実行します。 このコマンドにより 2 つのファイルが生成されます。 生成された公開鍵は `<your key>.pub` ファイルに含まれています。

ロード・バランサーを作成してリスナーに HTTPS を使用する予定の場合は、SSL 証明書が必要です。 [IBM Certificate Manager ![外部リンク・アイコン](../../icons/launch-glyph.svg "外部リンク・アイコン")](https://{DomainName}/catalog/services/certificate-manager){: new_window} を使用して証明書を管理できます。 また、SSL 証明書が含まれる Certificate Manager インスタンスにロード・バランサー・インスタンスがアクセスできるようにする許可を作成する必要があります。 [ID およびアクセス許可 ![外部リンク・アイコン](../../icons/launch-glyph.svg "外部リンク・アイコン")](https://{DomainName}/iam/#/authorizations){: new_window} を使用して許可を作成できます。 ソースの場合、ソース・サービスとして**「インフラストラクチャー・サービス」**、リソース・タイプとして**「Load Balancer for VPC」**、ソース・リソース・インスタンスとして**「すべてのリソース・インスタンス」**を選択します。ターゲット・サービスとして**「Certificate Manager」**を選択して、サービスのアクセス役割として**「ライター」**を割り当てます。 ターゲット・サービス・インスタンスに**「すべてのインスタンス」**または特定の Certificate Manager インスタンスを設定します。 詳しくは、[Using Load Balancers in IBM Cloud VPC](/docs/vpc-on-classic-network?topic=vpc-on-classic-network---using-load-balancers-in-ibm-cloud-vpc) を参照してください。

## VPC およびサブネットの作成

VPC およびサブネットを作成するには、以下のようにします。

1. [{{site.data.keyword.cloud_notm}} コンソール ![外部リンク・アイコン](../../icons/launch-glyph.svg "外部リンク・アイコン")](https://{DomainName}){: new_window} を開きます。
1. **メニュー・アイコン ![メニュー・アイコン](../../icons/icon_hamburger.svg) >「VPC インフラストラクチャー」>「ネットワーク」>「VPC」**をクリックして、**「新規仮想プライベート・クラウド」**をクリックします。
1. VPC の名前 (`my-vpc` など) を入力します。
1. VPC のリソース・グループとそのすべての接続リソースを選択します。 リソース・グループを使用すると、アクセス制御や請求処理のためにアカウント・リソースを編成できます。 詳しくは、『[リソースをリソース・グループに編成するためのベスト・プラクティス](/docs/resources?topic=resources-bp_resourcegroups)』を参照してください。
1. _オプション:_ タグを入力すると、リソースの編成と検索に役立ちます。 後でさらにタグを追加できます。 詳しくは、『[タグの処理](/docs/resources?topic=resources-tag)』を参照してください。
1. この VPC の新規サブネットのデフォルト ACL を選択または作成します。 このチュートリアルでは、新規のデフォルト ACL を作成します。 後で ACL のルールを構成します。
1. この VPC の仮想サーバー・インスタンスへのインバウンドの SSH および ping のトラフィックが、デフォルトのセキュリティー・グループで許可されるかどうかを選択します。 後でデフォルトのセキュリティー・グループのルールをさらに構成します。
1. VPC の新規サブネットの名前 (`my-subnet` など) を入力します。
1. サブネットの場所を選択します。 場所は、地域とゾーンで構成されます。

    選択した地域は、VPC の地域として使用されます。 この VPC で作成するすべての追加リソースは、選択された地域で作成されます。
    {: tip}

1. サブネットの IP 範囲を CIDR 表記で入力します (例えば、`10.240.0.0/24`)。ほとんどの場合、デフォルトの IP 範囲を使用できます。 カスタム IP 範囲を指定する場合、IP 範囲計算器を使用して、別のアドレス接頭部を選択したりアドレスの数を変更したりすることができます。
1. サブネットの ACL を選択します。 この VPC で作成されたデフォルト ACL を使用するには、**「VPC デフォルトの使用」**を選択します。
1. パブリック・ゲートウェイをサブネットに接続して、すべての接続リソースがパブリック・インターネットと通信できるようにします。  

    サブネットを作成した後にパブリック・ゲートウェイを接続することもできます。
    {: tip}

1. **「仮想プライベート・クラウドの作成 (Create virtual private cloud)」**をクリックします。
1. この VPC で別のサブネットを作成するには、**「サブネット」**タブをクリックして、**「新規サブネット」**をクリックします。 サブネットを定義する場合、**「仮想プライベート・クラウド」**フィールドで `my_vpc` が選択されていることを確認します。

## ACL の構成

ACL を構成して、サブネットに対するインバウンドとアウトバウンドのトラフィックを制限できます。 デフォルトでは、すべてのトラフィックが許可されます。

各サブネットは、1 つの ACL にのみ接続できます。 ただし、各 ACL は複数のサブネットに接続できます。

ACL を構成するには、以下のようにします。

1. ナビゲーション・ペインで**「ネットワーク」>「サブネット」**をクリックします。
1. 作成したサブネットをクリックします。
1. **「サブネットの詳細」**エリアで、ACL の名前をクリックします。
1. **「ルールの追加」**をクリックして、サブネットへのまたはサブネットからのどのようなトラフィックが許可されるかを定義する、インバウンド・ルールとアウトバウンド・ルールを構成します。 ルールごとに、以下の情報を指定します。  
   * ルールの優先順位を指定します。 小さい数値のルールが最初に評価され、大きい数値のルールをオーバーライドします。 例えば、優先順位 2 のルールで HTTP トラフィックが許可され、優先順位 5 のルールがすべてのトラフィックを拒否する場合、HTTP トラフィックは引き続き許可されます。  
   * 指定したトラフィックが許可されるのかまたは拒否されるのかを選択します。  
   * CIDR ブロックを指定して、ルールが適用される IP 範囲を示します。
   * ルールが適用されるプロトコルおよびポートを選択します。
1. ルールの作成を完了したら、ページ上部の**「すべてのアクセス制御リスト」**階層リンクをクリックします。

### ACL の例

例えば、以下のことを行うインバウンド・ルールを構成できます。

 1. インターネットからの HTTP トラフィックを許可する
 1. サブネット 10.10.20.0/24 からのすべてのインバウンド・トラフィックを許可する
 1. その他のすべてのインバウンド・トラフィックを拒否する  

次に、以下のことを行うアウトバウンド・ルールを構成します。

1. インターネットへの HTTP トラフィックを許可する
1. サブネット 10.10.20.0/24 へのすべてのアウトバウンド・トラフィックを許可する
1. その他のすべてのアウトバウンド・トラフィックを拒否する  

![インバウンド・ルールとアウトバウンド・ルールの例を示します](images/acl-rules.png)

## 仮想サーバー・インスタンスの作成

新規に作成されたサブネットで仮想サーバー・インスタンスを作成するには、以下のようにします。

1. ナビゲーション・ペインで、**「コンピュート」>「仮想サーバー・インスタンス」**をクリックして、**「新規インスタンス」**をクリックします。
1. インスタンスの名前 (`my-instance` など) を入力します。
1. 作成した VPC を選択します。
1. **「場所」**フィールドで、インスタンスを作成するゾーンを選択します。
1. イメージ (つまり、オペレーティング・システムとバージョン) を選択します。例えば Ubuntu Linux 16.04 などです。
1. インスタンスのサイズを設定するには、一般的なプロファイルのいずれかを選択するか、または**「すべてのプロファイル」**をクリックして、ワークロードに最適な別のコアと RAM の組み合わせを選択します。
1. 仮想サーバー・インスタンスへのアクセスに使用する、既存の SSH 鍵を選択するか、新規 SSH 鍵を追加します。 SSH 鍵を追加するには、**「新規鍵」**をクリックして鍵を指定します。 事前に生成した公開鍵の値を入力した後、**「SSH 鍵の追加」**をクリックします。

鍵は最初に VSI の作成の一環としてのみ追加できます。後で鍵を追加する方法はありません。
{:tip}

1. _オプション:_ インスタンス開始時に共通構成タスクを実行するためのユーザー・データを入力します。 例えば、cloud-init ディレクティブまたは Linux イメージのシェル・スクリプトを指定できます。 詳しくは、[User Data](/docs/vpc-on-classic-vsi?topic=vpc-on-classic-vsi-user-data) を参照してください。
1. ブート・ボリュームをメモします。 現行リリースでは、ブート・ボリュームに 100 GB が割り当てられます。 *自動削除* がボリュームに対して有効です。インスタンスが削除されると、ボリュームは自動的に削除されます。
1. **「接続済みブロック・ストレージ・ボリューム (Attached block storage volume)」**領域で、**「新規ブロック・ストレージ・ボリューム (New block storage volume)」**をクリックしてブロック・ストレージ・ボリュームをインスタンスに接続できます。このチュートリアルでは、ブロック・ストレージ・ボリュームを作成し、そのボリュームを後でインスタンスに接続します。
1. **「ネットワーク・インターフェース」**エリアで、ネットワーク・インターフェースを編集して、その名前を変更できます。選択したゾーンおよび VPC に複数のサブネットがある場合、別のサブネットをこのインターフェースに接続できます。 複数のサブネットにインスタンスを存在させる場合は、さらにインターフェースを作成できます。

   各インターフェースにどのセキュリティー・グループを接続するかを選択することもできます。 デフォルトでは、VPC のデフォルト・セキュリティー・グループが接続されます。 デフォルトのセキュリティー・グループによって、SSH および ping のインバウンド・トラフィック、すべてのアウトバウンド・トラフィック、およびグループ内のインスタンス間のすべてのトラフィックが許可されます。 その他のすべてのトラフィックはブロックされますが、その他のトラフィックを許可するためのルールを構成することができます。 後でデフォルトのセキュリティー・グループのルールを編集すると、これらの更新されたルールが、グループ内の現在および将来のすべてのインスタンスに適用されます。

1. **「仮想サーバー・インスタンスの作成 (Create virtual server instance)」**をクリックします。 インスタンスの状況は、*処理待ち* から始まり、*停止済み*、次に、*電源オン* に変わります。 状況の変更を確認するためにページの最新表示が必要な場合もあります。

## ブロック・ストレージ・ボリュームの作成と接続

ブロック・ストレージ・ボリュームを作成し、それを仮想サーバー・インスタンスに接続できます。

ブロック・ストレージ・ボリュームを作成して接続するには、以下のようにします。

1. ナビゲーション・ペインで**「ストレージ」>「ブロック・ストレージ・ボリューム (Block storage volumes)」**をクリックします。
1. 「VPC 用ブロック・ストレージ・ボリューム (Block storage volumes for VPC)」ページで、**「新規ボリューム」**をクリックし、以下の情報を指定します。
  * **名前**: ブロック・ストレージ・ボリュームの名前 (`data-volume-1` など) を入力します。  
  * **リソース・グループ**: ブロック・ストレージ・ボリュームのリソース・グループを選択します。リソース・グループを使用すると、アクセス制御や請求処理のためにアカウント・リソースを編成できます。 詳しくは、『[リソースをリソース・グループに編成するためのベスト・プラクティス](/docs/resources?topic=resources-bp_resourcegroups)』を参照してください。
  * **タグ**: _オプション:_ タグを入力すると、リソースの編成と検索に役立ちます。後でさらにタグを追加できます。 詳しくは、『[タグの処理](/docs/resources?topic=resources-tag)』を参照してください。
  * **場所**: ブロック・ストレージ・ボリュームの場所を選択します。場所は、地域とゾーンで構成されます (例: 米国南部 1)。
  * **サイズ**: ボリュームのサイズを 10 GB から 2000 GB の間で指定します。
  * **IOP**: IOP 層のいずれかを選択するか、「カスタム」をクリックしてボリューム・サイズに基づいて IOP 値を入力します。
  * **暗号化**: デフォルトのプロバイダー管理暗号化を受け入れるか、「お客様管理 (Customer managed)」を選択して独自の暗号鍵を使用します。このステップでは、Key Protect サービス・インスタンスをプロビジョンし、ルート・キーを作成またはインポートする必要があります。詳しくは、[お客様管理暗号化を使用したブロック・ストレージ・ボリュームの作成](/docs/vpc-on-classic-block-storage?topic=vpc-on-classic-block-storage-block-storage-encryption#data-vol-encryption-ui)を参照してください。
1. **「ボリュームの作成 (Create volume)」**をクリックします。
1. ブロック・ストレージ・ボリュームのリストで、作成したボリュームを見つけます。状況が「使用可能」の場合、「...」をクリックし、**「インスタンスに接続 (Attach to instance)」**を選択します。
1. ボリュームの接続先のインスタンスを選択して、**「接続 (Attach)」**をクリックします。

## インスタンスのセキュリティー・グループの構成

セキュリティー・グループを構成して、インスタンスで許可されるインバウンドとアウトバウンドのトラフィックを定義できます。 例えば、会社のセキュリティー・ポリシーに基づいてサブネットの ACL ルールを構成した後、特定のインスタンスのワークロードに応じてそれらのトラフィックをさらに制限できます。

セキュリティー・グループを構成するには、以下のようにします。

1. 「仮想サーバー・インスタンス」ページで、インスタンスをクリックして詳細を表示します。
1. **「ネットワーク・インターフェース」**セクションで、セキュリティー・グループをクリックします。
1. **「ルールの追加」**をクリックして、インスタンスへのまたはインスタンスからのどのようなタイプのトラフィックが許可されるかを定義する、インバウンド・ルールとアウトバウンド・ルールを構成します。 ルールごとに、以下の情報を指定します。  
   * トラフィックが許可される CIDR ブロックまたは IP アドレスを指定します。 あるいは、同じ VPC 内のセキュリティー・グループを指定して、その選択されたセキュリティー・グループに接続するすべてのインスタンスとの間のトラフィックを許可することができます。   
   * ルールが適用されるプロトコルおよびポートを選択します。    

   **ヒント:**  
  * 追加される順序にかかわらず、すべてのルールが評価されます。
  * ルールはステートフルです。つまり、許可されたトラフィックに応答して返されるトラフィックは自動的に許可されます。 例えば、ポート 80 でインバウンド TCP トラフィックを許可するルールでは、ポート 80 で発信元ホストへの返信アウトバウンド TCP トラフィックも許可され、このための追加ルールは不要です。
1. _オプション:_ 他のインスタンスにこのセキュリティー・グループを接続する場合は、ナビゲーション・ペインで**「接続済みインターフェース」**をクリックして、追加のインターフェースを選択します。
1. ルールの作成を完了したら、ページ上部の**「すべてのセキュリティー・グループ」**階層リンクをクリックします。

### セキュリティー・グループの例  

例えば、以下のことを行うインバウンド・ルールを構成できます。

 * すべての SSH トラフィック (TCP ポート 22) を許可する
 * すべての ping トラフィック (ICMP タイプ 8) を許可する

次に、すべての TCP トラフィックを許可するアウトバウンド・ルールを構成します。

![インバウンド・ルールとアウトバウンド・ルールの例を示します](images/sg-example-ui.png)

## 浮動 IP アドレスの予約

浮動 IP アドレスを予約および関連付けして、インターネットからインスタンスに接続できるようにします。  

浮動 IP アドレスを関連付けるには、インスタンスが実行されている必要があります。 インスタンスが稼働中になるまで数分かかることがあります。
{: tip}

浮動 IP アドレスを予約および関連付けするには、以下のようにします。

1. 「仮想サーバー・インスタンス」ページで、インスタンスをクリックして詳細を表示します。
1. **「ネットワーク・インターフェース」**セクションで、浮動 IP アドレスに関連付けるインターフェースの**「予約」**をクリックします。

後で同じゾーン内の別のインスタンスにこの浮動 IP アドレスを再割り当てする場合は、**「ネットワーク」>「浮動 IP」**ページでこの浮動 IP アドレスを見つけ、そのオーバーフロー・メニュー (**「...」**) をクリックして、**「関連付け解除」**をクリックします。 次に、**「関連付け」**をクリックして、この浮動 IP アドレスに関連付けるインスタンスとネットワーク・インターフェースを選択します。
{: tip}

## インスタンスへの接続
作成した浮動 IP アドレスを使用してインスタンスに ping し、インスタンスが稼働中であることを確認します。

```
ping <public-ip-address>
```
{:pre}


### Linux イメージへの接続

公開 SSH 鍵を使用してインスタンスを作成したので、秘密鍵を使用してインスタンスに直接接続できます。


```
ssh -i <path-to-private-key-file> root@<public-ip-address>
```
{:pre}

インスタンスへの接続方法について詳しくは、[Connecting to your instance using Linux](/docs/vpc-on-classic-vsi?topic=vpc-on-classic-vsi-connecting-to-your-linux-instance) を参照してください。

### Windows イメージへの接続
Windows イメージに接続するには、復号されたパスワードを使用してログインします。 復号されたパスワードを取得するには、暗号化されたパスワードをインスタンスの詳細ページからコピーし、以下のコマンドを実行します。

```
# Decode the encrypted password
cat ~/examplepwd | base64 --decode > ~/examplepwd64
# Decrypt the decoded password using the RSA private key
openssl pkeyutl -in ~/examplepwd64 -decrypt -inkey private.pem -pkeyopt rsa_padding_mode:oaep -pkeyopt rsa_oaep_md:sha256
-pkeyopt rsa_mgf1_md:sha256
```
{:codeblock}


インスタンスへの接続方法について詳しくは、[Connecting to your Windows instance](/docs/vpc-on-classic-vsi?topic=vpc-on-classic-vsi-connecting-to-your-windows-instance) を参照してください。



## インスタンスのモニタリング

インスタンスがいつ開始されたか、停止されたか、またはリブートされたかを示すアクティビティー・ログについては、ナビゲーション・ペインで**「アクティビティー」**をクリックします。

## ロード・バランサーの作成
ロード・バランサーを作成して、複数インスタンスにインバウンド・トラフィックを分散できます。

ロード・バランサーを作成するには、以下のようにします。
1. ナビゲーション・ペインで**「ネットワーク」>「ロード・バランサー」**をクリックします。
1. 「ロード・バランサー」ページで**「新規ロードバランサー」**をクリックして、以下の情報を指定します。
    * **名前**: ロード・バランサーの名前 (`my-load-balancer` など) を入力します。
    * **仮想プライベート・クラウド**: VPC を選択します。
    * **リソース・グループ**: ロード・バランサーのリソース・グループを選択します。
    * **タイプ**: ロード・バランサー・タイプ (パブリックまたはプライベート) を選択します。
    * **地域**: ロード・バランサーが作成される地域、つまり、VPC で選択された地域を示します。
    * **サブネット**: ロード・バランサーが作成されるサブネットを選択します。 アプリケーションの可用性を最大化するには、別のゾーンのサブネットを選択します。
1. **「新規プール」**をクリックして、バックエンド・プールを作成するために以下の情報を指定します。 1 つ以上のプールを作成できます。
    * **名前**: プールの名前 (`my-pool` など) を入力します。
    * **プロトコル**: ロード・バランサーの背後にあるバックエンド・インスタンスのプロトコルを選択します。 プールのプロトコルは、その関連リスナーのプロトコルと一致している必要があります。 例えば、リスナーで HTTPS プロトコルまたは HTTP プロトコルが選択されている場合、プールのプロトコルは HTTP にする必要があります。 同様に、リスナー・プロトコルが TCP である場合、バックエンド・プールのプロトコルは TCP にする必要があります。
    * **メソッド**:  ロード・バランサーでバックエンド・インスタンスにトラフィックを分散させる方法を選択します。
      * **ラウンドロビン:** 各インスタンスに要求を順番に転送します。 すべてのインスタンスが、ほぼ同数のクライアント接続を受信します。
      * **重みづけしたラウンドロビン:** 割り当てられた重みに比例して各インスタンスに要求を転送します。 例えば、インスタンス A、B、および C があり、それらの重みが 60、60、および 30 に設定されている場合、インスタンス A と B は同数の接続を受信し、インスタンス C はその半数の接続を受信します。
      * **最小接続数:** 現時点で接続数が最小のインスタンスに要求を転送します。  
    * **セッション維持率**: ユーザー・セッション中にすべての要求が同じインスタンスに送信されるかどうかを選択します。  
    * **ヘルス・チェック**: ロード・バランサーがインスタンスの正常性を検査する方法を構成します。
      * **ヘルス・プロトコル**: ロード・バランサーがバックエンド・インスタンスにヘルス・チェック・メッセージを送信するために使用するプロトコル。
      * **ヘルス・パス**: ヘルス・パスは、ヘルス・チェックのプロトコルとして HTTP が選択されている場合にのみ適用されます。 ヘルス・パスは、ロード・バランサーがバックエンド・インスタンスに HTTP ヘルス・チェック要求を送信するために使用する URL を指定します。 デフォルトでは、ヘルス・チェックはルート・パス (`/`) に送信されます。
      * **間隔**: 連続する 2 つのヘルス・チェック試行の間隔 (秒単位)。 デフォルトでは、ヘルス・チェックは 5 秒ごとに送信されます。
      * **タイムアウト**: システムがヘルス・チェック要求の応答を待機する最大時間。 デフォルトでは、ロード・バランサーは応答を 2 秒待ちます。
      * **最大再試行回数**: バックエンド・インスタンスが正常ではないと見なされるまでにロード・バランサーが試行する追加ヘルス・チェックの最大数。 デフォルトでは、ヘルス・チェックが 2 回失敗すると、インスタンスは正常ではないと見なされます。

        ロード・バランサーは正常ではないインスタンスへの接続の送信を停止しますが、ロード・バランサーは、それらのインスタンスの正常性を引き続きモニターし、ヘルス・チェックの試行が連続して 2 回成功してそれらが再び正常であると判別された場合は、それらの使用を再開します。

      バックエンド・インスタンスが正常ではなく、アプリケーションは正常に実行されている場合は、ヘルス・プロトコル値とヘルス・パス値を再確認してください。 また、インスタンスに接続されているセキュリティー・グループも確認して、ロード・バランサーとインスタンス間のトラフィックがルールで許可されていることを確認してください。
      {: tip}

1. **「作成」**をクリックします。
1. 新規プールの項目の隣にある**「インスタンス」**列の**「接続」**をクリックして、プールにインスタンスを追加します。 さらにインスタンスをプールに追加するには、**「追加」**をクリックします。 インスタンスごとに、以下の情報を指定します。
   * 選択するインスタンスがあるサブネットを 1 つ以上選択します。
   * インスタンスを選択します。 インスタンスに複数のインターフェースがある場合、正しい IP アドレスが選択されていることを確認します。
   * インスタンスにトラフィックを送信するためのポートを指定します。
   * プールで**「重みづけしたラウンドロビン」**メソッドが使用される場合、インスタンスごとに重みを割り当てます。  

      インスタンスへの重み「0」の割り当ては、そのインスタンスには新規接続は転送されないが、現行接続がアクティブである限り既存のトラフィックは引き続き流れることを意味します。 重み「0」を使用すると、インスタンスを正常終了し、サービス・ローテーションからそのサーバーを削除するのに役立ちます。
      {: tip}

1. **「新規リスナー」**をクリックして、リスナーを作成するために以下の情報を指定します。 1 つ以上のリスナーを作成できます。
   * **プロトコル**: 着信要求を受信するために使用するプロトコル。
   * **ポート**: 要求を受信するための listen ポート。 ポート範囲 56500 から 56520 は、管理目的用に予約されており、使用できません。
   * **バックエンド・プール**: このリスナーがトラフィックを転送するバックエンド・プール。
   * **最大接続数** (オプション): リスナーが許可する同時接続の最大数。
   * **SSL 証明書**: このリスナーで選択されたプロトコルが HTTPS である場合、SSL 証明書を選択する必要があります。 ロード・バランサーに SSL 証明書にアクセスする権限があることを確認してください。 手順については、[始める前に](#before)を参照してください。
1. **「作成」**をクリックします。
1. プールとリスナーの作成を完了したら、**「ロード・バランサーの作成 (Create load balancer)」**をクリックします。
1. 既存のロード・バランサーの詳細を表示するには、**「ロード・バランサー」**ページで、ロード・バランサーの名前をクリックします。

## VPN の作成
仮想プライベート・ネットワーク (VPN) を作成すると、VPC を別のプライベート・ネットワーク (オンプレミス・ネットワークや別の VPC など) に安全に接続できるようになります。

コード例を表示するには、[Using VPN with your VPC](/docs/vpc-on-classic-network?topic=vpc-on-classic-network---using-vpn-with-your-vpc) を参照してください。
{: tip}

VPN を作成するには、以下のようにします。
1. ナビゲーション・ペインで**「ネットワーク」>「VPN」**をクリックします。
1. 「VPN」ページで**「新規 VPN ゲートウェイ」**をクリックして、以下の情報を指定します。
    * **名前**: 仮想プライベート・クラウドの VPN ゲートウェイの名前 (`my-vpn-gateway` など) を入力します。
    * **仮想プライベート・クラウド**: VPC を選択します。
    * **リソース・グループ**: VPN のリソース・グループを選択します。
    * **サブネット**: VPN ゲートウェイを作成するサブネットを選択します。
1. **「新規 VPN 接続」**セクションで、以下の情報を指定して、このゲートウェイと VPC 外部のネットワーク間の接続を定義します。
    * **接続名**: 接続の名前 (`my-connection` など) を入力します。
    * **ピア・ゲートウェイ・アドレス**: VPC 外部のネットワークの VPN ゲートウェイの IP アドレスを指定します。
    * **事前共有鍵**: VPC 外部のネットワークの VPN ゲートウェイの認証鍵を指定します。
    * **ローカル・サブネット**: VPN トンネルを介して接続する VPC のサブネットを 1 つ以上指定します。
    * **ピア・サブネット**: VPN トンネルを介して接続するもう一方のネットワークのサブネットを 1 つ以上指定します。
1. ピア・ゲートウェイがアクティブであることを確認するためにクラウド・ゲートウェイがメッセージを送信する方法を構成するには、**「非活動ピア検出」**セクションで以下の情報を指定します。
    * **非活動ピア検出アクション**: ピア・ゲートウェイが応答を停止した場合に取るアクション。 例えば、ゲートウェイで即時に接続の再ネゴシエーションを実行する場合は、**「再始動」**を選択します。
    * **間隔**: ピア・ゲートウェイがアクティブであることを確認する頻度。 デフォルトでは、30 秒ごとにメッセージが送信されます。
    * **タイムアウト**: ピア・ゲートウェイからの応答を待機する時間。 デフォルトでは、応答が 150 秒内に受信されない場合、ピア・ゲートウェイはアクティブではないと見なされます。
1. 接続のために IKE および IPsec のセキュリティー・パラメーターを指定します。
    * クラウド・ゲートウェイが接続の確立を自動的に試行するように設定する場合は、**「自動」**を選択します。
    * 特定のセキュリティー要件を強制する必要がある場合や、もう一方のネットワークの VPN ゲートウェイが、オートネゴシエーションで試行されるセキュリティー・プロポーザルをサポートしていない場合は、カスタム・ポリシーを選択または作成します。

  **重要**: 接続のために指定する IKE および IPsec のセキュリティー・パラメーターは、VPC 外部のネットワークのゲートウェイで設定されているパラメーターと同じである必要があります。

## これで完了です。

VPC とサブネット、ACL、仮想サーバー・インスタンス、ブロック・ストレージ・ボリューム、セキュリティー・グループ、浮動 IP アドレス、ロード・バランサー、および VPN を正常に作成して構成できました。インスタンス、サブネット、およびその他のリソースをさらに追加して、VPC の開発を続けることができます。
